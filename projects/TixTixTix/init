require("Application")
require("game")

function Application:configure(event)
  log.debug("Application:configure()")
  self.config.displayAttributes = lost.common.DisplayAttributes()
  if lost.platform.isIPhone() then
    log.debug("iPhone")
    self.config.displayAttributes.width = 320
    self.config.displayAttributes.height = 480
  else
    log.debug("Desktop")
    self.config.displayAttributes.width = 800
    self.config.displayAttributes.height = 600
  end
  self.config.displayAttributes.redbits = 8
  self.config.displayAttributes.bluebits = 8
  self.config.displayAttributes.greenbits = 8
  self.config.displayAttributes.alphabits = 8
  self.config.displayAttributes.depthbits = 24
  self.config.displayAttributes.stencilbits = 0
  self.config.displayAttributes.fullscreen = false
  self.config.displayAttributes.title = "TixTixTix - The Combination of the beast"
end

function Application:init(event)
  log.debug("Application:init()")

  self:addEventListener(lost.application.ResizeEvent.MAIN_WINDOW_RESIZE, resizeHandler)

  if lost.platform.isIPhone() then
    self:addEventListener(lost.application.TouchEvent.TOUCHES_BEGAN, touchHandler)
  else
    self:addEventListener(lost.application.KeyEvent.KEY_DOWN, keyHandler)
    self:addEventListener(lost.application.KeyEvent.KEY_UP, keyHandler)
    self:addEventListener(lost.application.MouseEvent.MOUSE_DOWN, clickHandler)
  end
  
  controls = {}
  controls.fpsMeter = lost.common.FpsMeter()
  controls.fpsMeter.alpha = 0.25

  self.config.FieldSize = lost.math.Vec2((self.config.displayAttributes.width / 3), (self.config.displayAttributes.height / 3))

  globals.timer = lost.application.Timer("luarender", 0.02)
  globals.timer:addEventListener(lost.application.TimerEvent.TIMER_FIRED, renderHandler)
end
